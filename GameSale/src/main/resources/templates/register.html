<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新規登録 - GameSale</title>

    <style>
        body {
            font-family: sans-serif;
            background: #0e0e0e;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .card {
            background: #1e1e1e;
            padding: 2rem;
            border-radius: 12px;
            width: 360px;
            box-sizing: border-box;
        }

        input {
            width: 100%;
            padding: 10px 40px 10px 10px; /* 右側にアイコン分の余白 */
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #333;
            background: #0f0f0f;
            color: #fff;
            box-sizing: border-box;
            height: 40px; /* 高さを固定してアイコンと揃える */
        }

        .submit-btn {
            width: 100%;
            padding: 0.7rem;
            border-radius: 6px;
            background: #0078d4;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        .error {
            color: #ff6666;
            margin-top: 0.5rem;
        }

        a {
            color: #00aaff;
            text-decoration: none;
        }

        form > * + * {
            margin-top: 1rem;
        }

        .pw-wrap {
            position: relative;
            display: flex;
            align-items: center; /* 入力欄とアイコンを縦中央に揃える */
        }

        .pw-eye {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pw-eye svg {
            width: 22px;
            height: 22px;
            stroke: #bbb;
            fill: none;
        }

        .pw-eye:hover svg {
            stroke: #fff;
        }

        .pw-note {
            font-size: 12px;
            color: #bbb;
            margin-top: 0.3rem;
        }

        .pw-checklist {
            font-size: 12px;
            margin-top: 0.3rem;
            line-height: 1.3;
        }

        .pw-checklist span {
            display: block;
            margin-top: 2px;
        }

        .valid { color: #00ff00; }
        .invalid { color: #ff6666; }
    </style>
</head>

<body>
<div class="card">
    <h2>新規登録</h2>

    <form th:action="@{/register}" method="post">
        <div class="error" th:if="${error}" th:text="${error}"></div>

        <input type="text"
               name="account_name"
               placeholder="アカウント名"
               th:value="${account_name}"
               required>

        <input type="email"
               name="email"
               placeholder="メールアドレス"
               th:value="${email}"
               required>

        <!-- パスワード -->
        <div class="pw-wrap">
            <input type="password"
                   id="password"
                   name="password"
                   placeholder="パスワード"
                   required>
            <span class="pw-eye" onclick="togglePassword('password')">
                <svg viewBox="0 0 24 24">
                    <path d="M1.5 12s4-7.5 10.5-7.5S22.5 12 22.5 12s-4 7.5-10.5 7.5S1.5 12 1.5 12z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </span>
        </div>
        <div class="pw-note">パスワードは英大文字・英小文字・数字をすべて含める必要があります。</div>
        <div class="pw-checklist">
            <span id="chk-uppercase" class="invalid">❌ 大文字を含む</span>
            <span id="chk-lowercase" class="invalid">❌ 小文字を含む</span>
            <span id="chk-number" class="invalid">❌ 数字を含む</span>
        </div>

        <!-- パスワード確認 -->
        <div class="pw-wrap">
            <input type="password"
                   id="password_confirm"
                   name="password_confirm"
                   placeholder="パスワード（確認）"
                   required>
            <span class="pw-eye" onclick="togglePassword('password_confirm')">
                <svg viewBox="0 0 24 24">
                    <path d="M1.5 12s4-7.5 10.5-7.5S22.5 12 22.5 12s-4 7.5-10.5 7.5S1.5 12 1.5 12z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </span>
        </div>

        <button class="submit-btn" type="submit">認証コードを送信</button>
        <div class="error" id="submit-error"></div>
    </form>

    <p style="margin-top: 1rem;">
        <a href="/login">ログインはこちら</a>
    </p>
</div>

<script>
function togglePassword(id) {
    const input = document.getElementById(id);
    const span = input.nextElementSibling;
    if (input.type === 'password') {
        input.type = 'text';
        span.innerHTML = `<svg viewBox="0 0 24 24"><path d="M17.94 17.94A10.94 10.94 0 0 1 12 19.5C5.5 19.5 1.5 12 1.5 12c1.48-2.72 4.1-5.19 7.4-6.53"></path><path d="M3 3l18 18"></path></svg>`;
    } else {
        input.type = 'password';
        span.innerHTML = `<svg viewBox="0 0 24 24"><path d="M1.5 12s4-7.5 10.5-7.5S22.5 12 22.5 12s-4 7.5-10.5 7.5S1.5 12 1.5 12z"></path><circle cx="12" cy="12" r="3"></circle></svg>`;
    }
}

// リアルタイムパスワード条件チェック
const passwordInput = document.getElementById('password');
const chkUpper = document.getElementById('chk-uppercase');
const chkLower = document.getElementById('chk-lowercase');
const chkNumber = document.getElementById('chk-number');

passwordInput.addEventListener('input', function() {
    const val = passwordInput.value;

    chkUpper.textContent = /[A-Z]/.test(val) ? '✅ 大文字を含む' : '❌ 大文字を含む';
    chkUpper.className = /[A-Z]/.test(val) ? 'valid' : 'invalid';

    chkLower.textContent = /[a-z]/.test(val) ? '✅ 小文字を含む' : '❌ 小文字を含む';
    chkLower.className = /[a-z]/.test(val) ? 'valid' : 'invalid';

    chkNumber.textContent = /\d/.test(val) ? '✅ 数字を含む' : '❌ 数字を含む';
    chkNumber.className = /\d/.test(val) ? 'valid' : 'invalid';
});

// 送信時バリデーション（ユーザーに原因を表示）
document.querySelector('form').addEventListener('submit', function(event) {
    const password = document.getElementById('password').value;
    const passwordConfirm = document.getElementById('password_confirm').value;
    const submitErrorDiv = document.getElementById('submit-error');
    const pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/;

    let messages = [];

    if (!pattern.test(password)) {
        messages.push("パスワードは英大文字・英小文字・数字をすべて含める必要があります。");
    }

    if (password !== passwordConfirm) {
        messages.push("パスワードと確認用パスワードが一致しません。");
    }

    if (messages.length > 0) {
        event.preventDefault(); // 送信は止める
        submitErrorDiv.innerHTML = messages.join('<br>');
    } else {
        submitErrorDiv.textContent = "";
    }
});
</script>

</body>
</html>
